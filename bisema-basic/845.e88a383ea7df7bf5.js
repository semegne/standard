"use strict";(self.webpackChunkbisema_basic=self.webpackChunkbisema_basic||[]).push([[845],{3845:(q,_,s)=>{s.r(_),s.d(_,{AuthModule:()=>p});var l=s(6895),h=s(6491),c=s(433),m=s(2687),e=s(4650),v=s(5136);class a extends v.b{constructor(o){super(o)}login(o){return this._networkService.get(`api/login/${o.email}/${o.password}`)}getProjectsByDealerID(o){return this._networkService.get(`api/project/${o}`)}checkIfExistsWithName(o,t){return this._networkService.post("api/project/checkIfExistsWithName",{dealers_id:o,projectName:t})}createProject(o){return this._networkService.post("api/project/create",o)}}a.\u0275fac=function(o){return new(o||a)(e.LFG(e.zs3))},a.\u0275prov=e.Yz7({token:a,factory:a.\u0275fac});var j=s(3478),x=s(1815),b=s(2216);const Z=function(){return{label1:"Email"}},w=function(){return{label1:"Password"}};function A(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"div",5)(1,"div",6),e.ynx(2),e.TgZ(3,"h1",7),e._uU(4,"BiSemA"),e.qZA(),e.TgZ(5,"p",7),e._uU(6,"Please enter your account details to login"),e.qZA(),e.TgZ(7,"form",8),e.NdJ("submit",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.submit())}),e.TgZ(8,"div",9)(9,"div",10),e._UZ(10,"input",11),e.TgZ(11,"div",12)(12,"span",13),e._UZ(13,"fa-icon",14),e.qZA()()(),e.TgZ(14,"label",15),e._UZ(15,"app-form-error-message",16),e.qZA()(),e.TgZ(16,"div",9)(17,"div",10),e._UZ(18,"input",17),e.TgZ(19,"div",12)(20,"span",13),e._UZ(21,"fa-icon",14),e.qZA()()(),e.TgZ(22,"label",15),e._UZ(23,"app-form-error-message",16),e.qZA()(),e.TgZ(24,"div",18)(25,"div",19),e._UZ(26,"input",20),e.qZA(),e.TgZ(27,"div",21)(28,"div",22)(29,"span",13),e._UZ(30,"fa-icon",14),e.qZA()(),e.TgZ(31,"button",23),e._UZ(32,"fa-icon",14),e._uU(33," Login "),e.qZA()()()(),e.BQk(),e.qZA()()}if(2&r){const t=e.oxw();e.xp6(7),e.Q6J("formGroup",t.loginForm),e.xp6(6),e.Q6J("icon",t.faEnvelope),e.xp6(2),e.Q6J("control",t.loginForm.get("email"))("labels",e.DdM(10,Z)),e.xp6(6),e.Q6J("icon",t.faKey),e.xp6(2),e.Q6J("control",t.loginForm.get("password"))("labels",e.DdM(11,w)),e.xp6(7),e.Q6J("icon",t.faLock),e.xp6(1),e.Q6J("disabled",!t.loginForm.valid),e.xp6(1),e.Q6J("icon",t.faArrowRight)}}const y=function(r){return{project_table_even_row:r}};function U(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"div",38)(1,"div",39),e._uU(2),e.qZA(),e.TgZ(3,"div",40)(4,"a",41),e.NdJ("click",function(){const u=e.CHM(t).$implicit,f=e.oxw(2);return e.KtG(f.selectProject(u.id))}),e._uU(5),e.qZA()(),e.TgZ(6,"div",40),e._uU(7),e.ALo(8,"date"),e.qZA(),e.TgZ(9,"div",39),e._uU(10),e.qZA(),e.TgZ(11,"div",40),e._uU(12),e.ALo(13,"date"),e.qZA(),e.TgZ(14,"div",42),e._uU(15),e.ALo(16,"slice"),e.qZA()()}if(2&r){const t=o.$implicit,i=o.index,n=e.oxw(2);e.Q6J("ngClass",e.VKq(17,y,i%2==0)),e.xp6(2),e.Oqu(n.projects.length-i),e.xp6(3),e.Oqu(t.projectName),e.xp6(2),e.Oqu(e.xi3(8,7,t.createdAt,"MM/dd/yyyy")),e.xp6(3),e.Oqu(null==t.orderConfirmationDate?"No":"Yes"),e.xp6(2),e.Oqu(null==t.orderConfirmationDate?"Not exported":e.xi3(13,10,t.orderConfirmationDate,"MM/dd/yyyy")),e.xp6(3),e.Oqu(""==t.remark?"No remarks":t.remark.length>47?e.Dn7(16,13,t.remark,0,47)+"...":t.remark)}}function T(r,o){if(1&r&&(e.TgZ(0,"div",30)(1,"span",43),e._uU(2),e.qZA()()),2&r){const t=e.oxw(2);e.xp6(2),e.Oqu(t.projectSelectionErrorMessage)}}function C(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"div",24)(1,"div",25),e._UZ(2,"div"),e.TgZ(3,"h1",26),e._uU(4),e.qZA(),e.TgZ(5,"button",27),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.showAddProjectDialog=!0)}),e._uU(6,"New Project"),e.qZA()(),e.TgZ(7,"div",28),e.ynx(8),e.TgZ(9,"div",29)(10,"div",30),e._UZ(11,"div",31),e.TgZ(12,"div",32)(13,"span",33),e._uU(14,"Project Name"),e.qZA()(),e.TgZ(15,"div",32)(16,"span",33),e._uU(17,"Start Date"),e.qZA()(),e.TgZ(18,"div",31)(19,"span",33),e._uU(20,"Exported"),e.qZA()(),e.TgZ(21,"div",32)(22,"span",33),e._uU(23,"Exported Date"),e.qZA()(),e.TgZ(24,"div",34)(25,"span",33),e._uU(26,"Remark"),e.qZA()()(),e.TgZ(27,"div",35),e.YNc(28,U,17,19,"div",36),e.qZA(),e.YNc(29,T,3,1,"div",37),e.qZA(),e.BQk(),e.qZA()()}if(2&r){const t=e.oxw();e.xp6(4),e.hij("",t.loggedInUser.DealerName," Projects"),e.xp6(24),e.Q6J("ngForOf",t.projects),e.xp6(1),e.Q6J("ngIf",""!=t.projectSelectionErrorMessage)}}function N(r,o){1&r&&e._UZ(0,"div",44)}function k(r,o){if(1&r&&(e.TgZ(0,"div",55),e._uU(1),e.qZA()),2&r){const t=e.oxw(2);e.xp6(1),e.hij(" ",t.projectErrorMessage," ")}}function S(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"div",45)(1,"div",6)(2,"h1",46),e._uU(3,"Add new project"),e.qZA(),e.TgZ(4,"form",8),e.NdJ("submit",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.projectSelected())}),e.TgZ(5,"div",47)(6,"span",48),e._uU(7,"Project name:"),e.qZA(),e._UZ(8,"input",49),e.qZA(),e.TgZ(9,"div",47)(10,"span",48),e._uU(11,"Project remark:"),e.qZA(),e._UZ(12,"textarea",50),e.qZA(),e.YNc(13,k,2,1,"div",51),e.TgZ(14,"div",52)(15,"button",53),e._uU(16,"Save"),e.qZA(),e.TgZ(17,"button",54),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.cancelAddProject())}),e._uU(18,"Cancel"),e.qZA()()()()()}if(2&r){const t=e.oxw();e.xp6(4),e.Q6J("formGroup",t.projectForm),e.xp6(9),e.Q6J("ngIf",""!=t.projectErrorMessage)}}class g{constructor(o,t,i,n){this.fb=o,this.router=t,this.authService=i,this.businessCentralService=n,this.faEnvelope=m.FU$,this.faKey=m.DD4,this.faLock=m.byT,this.faArrowRight=m.eFW,this.loginErrorMessage="",this.loggedInUser="",this.dealers_id=0,this.projects=[],this.showAddProjectDialog=!1,this.projectSelectionErrorMessage="",this.projectErrorMessage="",this.loginForm=this.fb.group({email:["",[c.kI.required,c.kI.email]],password:["",[c.kI.required]]}),this.projectForm=this.fb.group({projectRemark:["",[c.kI.required]],projectName:["",[c.kI.required]]})}submit(){this.authService.login(this.loginForm.value).subscribe({next:t=>{"success"==t.status&&this.loadAllProjects(t.data)},error:t=>{console.log(t)}})}loadAllProjects(o){this.loggedInUser=o,this.dealers_id=this.loggedInUser.dealers_id,this.dealers_id||(this.dealers_id=this.loggedInUser.id),this.authService.getProjectsByDealerID(this.dealers_id).subscribe({next:t=>{this.projects=t.sort((i,n)=>n.id-i.id)},error:t=>{console.log(`Failed to get projects by dealer id. Error details: ${JSON.stringify(t)}`)}})}selectProject(o){const t=this.projects.filter(i=>i.id===o);t&&t.length>0?t[0].isClosed?this.projectSelectionErrorMessage="Please select project which is not exported. You cannot proceed with exported project.":this.updateUserDetailsAndLogin(t[0].id,t[0].projectName,t[0].BCProjectNumber):this.projectSelectionErrorMessage="Something went wrong ! Project not found. please try again and if issue persist contact administrator."}updateUserDetailsAndLogin(o,t,i,n=!1){this.loggedInUser.projectID=parseInt(o),this.loggedInUser.projectName=t,this.loggedInUser.BCProjectNumber=i,localStorage.setItem("user",JSON.stringify(this.loggedInUser)),this.projectForm.reset(),this.showAddProjectDialog=!1,n&&this.authService.getProjectsByDealerID(this.dealers_id).subscribe({next:u=>{this.projects=u.sort((f,P)=>P.id-f.id)},error:u=>{console.log(`Failed to get projects by dealer id. Error details: ${JSON.stringify(u)}`)}}),void 0===this.loggedInUser.dealers_id?window.open("/cart","_blank"):window.open("/specification","_blank")}projectSelected(){this.projectErrorMessage="",""===this.projectForm.value.projectName?this.projectErrorMessage="Please enter project name.":""===this.projectForm.value.projectRemark?this.projectErrorMessage="Please enter project remark.":this.dealers_id>0?this.authService.checkIfExistsWithName(this.dealers_id,this.projectForm.value.projectName).subscribe({next:o=>{0==o.data?this.createBiSemASalesHeader():this.projectErrorMessage=o.message},error:o=>{console.log(`Error occured while checking if project exists same name or not. Error details: ${JSON.stringify(o)}`)}}):this.projectErrorMessage="Something went wrong ! Dealer not found. Please try again and if issue persist contact administrator."}createBiSemASalesHeader(){let o={projectName:this.projectForm.value.projectName,isBiSemARecord:!0,documentType:"Order",selltocustomerNumber:"10000",orderDate:`${(new Date).getFullYear()}-${("0"+((new Date).getMonth()+1)).slice(-2)}-${("0"+(new Date).getDate()).slice(-2)}`};this.businessCentralService.postDetailsInDynamics(o,"BiSemASalesHeader",this.loggedInUser).subscribe({next:t=>{t?this.authService.createProject({dealers_id:this.dealers_id,projectName:this.projectForm.value.projectName,remark:this.projectForm.value.projectRemark,projectNumber:t.number}).subscribe({next:i=>{i.data>0?this.updateUserDetailsAndLogin(i.data,this.projectForm.value.projectName,t.number,!0):this.projectErrorMessage=i.message},error:i=>{console.log(`Error occured while creating project. Error details: ${JSON.stringify(i)}`)}}):console.log("BiSemA Sales Header not created")},error:t=>{console.log(`error occured while calling dynamics BiSemA Sales Header call : ${JSON.stringify(t)}`)}})}cancelAddProject(){this.showAddProjectDialog=!1}ngOnInit(){}}g.\u0275fac=function(o){return new(o||g)(e.Y36(c.qu),e.Y36(h.F0),e.Y36(a),e.Y36(j.y))},g.\u0275cmp=e.Xpm({type:g,selectors:[["app-login"]],decls:5,vars:4,consts:[[1,"d-flex","h-100","align-items-center","justify-content-center"],["class","card w-md-100",4,"ngIf"],["class","card w-100 m-5",4,"ngIf"],["class","dialog_overlay",4,"ngIf"],["class","card dialog",4,"ngIf"],[1,"card","w-md-100"],[1,"card-body","bg-purple"],[1,"text-center","text-white"],[3,"formGroup","submit"],[1,"form-group","mb-1"],[1,"input-group"],["type","text","placeholder","Your Email","formControlName","email",1,"form-control"],[1,"input-group-append"],[1,"input-group-text"],[3,"icon"],[1,"text-white"],["fieldType","input",3,"control","labels"],["type","password","placeholder","Your Password","formControlName","password",1,"form-control"],[1,"d-flex","justify-content-between"],[1,"form-check","form-switch"],["type","checkbox","role","switch","id","flexSwitchCheckDefault",1,"form-check-input"],[1,"input-group","d-flex","justify-content-end"],[1,"input-group-prepend"],["type","submit",1,"btn","btn-success",3,"disabled"],[1,"card","w-100","m-5"],[1,"card-header","d-flex","justify-content-between","align-items-center","bg-purple"],[1,"text-center","text-white","mb-0"],[1,"btn","btn-success","new_project_button",3,"click"],[1,"card-body"],[1,"pb-0","pt-0","pr-0","pl-0","project_table_header_border"],[1,"row","ml-0","mr-0","bg-purple"],[1,"col-1"],[1,"col-2"],[1,"text-white","project_table_header"],[1,"col-4"],[1,"project_table_body"],["class","row ml-0 mr-0",3,"ngClass",4,"ngFor","ngForOf"],["class","row ml-0 mr-0 bg-purple",4,"ngIf"],[1,"row","ml-0","mr-0",3,"ngClass"],[1,"col-1","pt-2","pb-2"],[1,"col-2","pt-2","pb-2"],["href","javascript:void;",3,"click"],[1,"col-4","pt-2","pb-2"],[1,"pt-2","pb-2","text-center","text-white","project_error_message"],[1,"dialog_overlay"],[1,"card","dialog"],[1,"text-center","text-white","mb-3"],[1,"input-group","mb-3"],[1,"text-white","mt-2","mr-3",2,"width","20%"],["type","text","formControlName","projectName",1,"form-control"],["formControlName","projectRemark",1,"form-control"],["class","input-group mb-3 text-white text-center","style","display: block",4,"ngIf"],[1,"mb-3","text-center"],["type","submit",1,"btn","btn-success","btn2","mr-3"],[1,"btn","btn-success","btn2",3,"click"],[1,"input-group","mb-3","text-white","text-center",2,"display","block"]],template:function(o,t){1&o&&(e.TgZ(0,"div",0),e.YNc(1,A,34,12,"div",1),e.YNc(2,C,30,3,"div",2),e.qZA(),e.YNc(3,N,1,0,"div",3),e.YNc(4,S,19,2,"div",4)),2&o&&(e.xp6(1),e.Q6J("ngIf",!t.loggedInUser),e.xp6(1),e.Q6J("ngIf",t.loggedInUser),e.xp6(1),e.Q6J("ngIf",t.showAddProjectDialog),e.xp6(1),e.Q6J("ngIf",t.showAddProjectDialog))},dependencies:[l.mk,l.sg,l.O5,x.J,c._Y,c.Fj,c.JJ,c.JL,c.sg,c.u,b.BN,l.OU,l.uU],styles:[".card[_ngcontent-%COMP%]{width:35%}.project_table_header[_ngcontent-%COMP%]{font-size:14px!important;font-weight:700;position:relative;float:left;margin:8px 0}.project_table_header_border[_ngcontent-%COMP%]{border-top:1px solid #fff}.project_table_body[_ngcontent-%COMP%]{max-height:288px;overflow-y:auto}.project_error_message[_ngcontent-%COMP%]{width:100%}.new_project_button[_ngcontent-%COMP%]{margin:10px 10px 0 0}.project_table_even_row[_ngcontent-%COMP%]{background-color:#eedfff}.dialog[_ngcontent-%COMP%]{top:50%;left:50%;width:50em;margin-top:-9em;margin-left:-25em;position:fixed;border:none!important;z-index:9999}.dialog_overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:#000;opacity:.4;z-index:999}"]});const I=[{path:"",component:g}];class d{}d.\u0275fac=function(o){return new(o||d)},d.\u0275mod=e.oAB({type:d}),d.\u0275inj=e.cJS({imports:[h.Bz.forChild(I),h.Bz]});var M=s(710);class p{}p.\u0275fac=function(o){return new(o||p)},p.\u0275mod=e.oAB({type:p}),p.\u0275inj=e.cJS({providers:[a],imports:[l.ez,M.m,d]})}}]);