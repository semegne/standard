"use strict";(self.webpackChunkbisema_basic=self.webpackChunkbisema_basic||[]).push([[515],{2515:(ft,N,c)=>{c.r(N),c.d(N,{CartModule:()=>_});var g=c(6895),x=c(6491),l=c(433),b=c(9579),P=c(5133),I=c(2340),m=c(2687),t=c(1571),S=c(6814),D=c(5136);class u extends D.b{constructor(i){super(i)}getAdminCartItems(i,e){return this._networkService.get(`api/get/admin/cart/${i}/${e}`)}updateCartItem(i,e){return this._networkService.put(`api/cart/update/${e}`,i)}deleteCartItems(i){return this._networkService.post("api/cart/delete",i)}}u.\u0275fac=function(i){return new(i||u)(t.LFG(t.zs3))},u.\u0275prov=t.Yz7({token:u,factory:u.\u0275fac});var y=c(6916),Z=c(6952),v=c(3478),O=c(7103),j=c(2216),w=c(3666);const A=["cartCheckboxes"];function U(s,i){if(1&s&&(t.TgZ(0,"option",25),t._uU(1),t.qZA()),2&s){const e=i.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.projectName," ")}}function J(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",26),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.cloneProject())}),t._UZ(1,"fa-icon",2),t._uU(2),t.qZA()}if(2&s){const e=t.oxw(2);t.xp6(1),t.Q6J("icon",e.faCogs),t.xp6(1),t.hij(" ",e.cloneProjectButtonText," ")}}function k(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",26),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(3);return t.KtG(n.cloneProject())}),t._UZ(1,"fa-icon",2),t._uU(2),t.qZA()}if(2&s){const e=t.oxw(3);t.xp6(1),t.Q6J("icon",e.faCogs),t.xp6(1),t.hij(" ",e.cloneProjectButtonText," ")}}function M(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"div",19)(1,"h4",1),t._UZ(2,"fa-icon",2),t.TgZ(3,"small",3)(4,"b"),t._uU(5," New Project Name : "),t.qZA()()(),t.TgZ(6,"input",27),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw(2);return t.KtG(o.newProjectName=n)}),t.qZA(),t.YNc(7,k,3,2,"button",23),t.TgZ(8,"button",26),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.cancelProjectCreate())}),t._UZ(9,"fa-icon",2),t._uU(10," Cancel "),t.qZA()()}if(2&s){const e=t.oxw(2);t.xp6(2),t.Q6J("icon",e.faCogs),t.xp6(4),t.Q6J("ngModel",e.newProjectName),t.xp6(1),t.Q6J("ngIf","0"!=e.projectID),t.xp6(2),t.Q6J("icon",e.faCogs)}}function q(s,i){if(1&s){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",19)(2,"h4",1),t._UZ(3,"fa-icon",2),t.TgZ(4,"small",3)(5,"b"),t._uU(6," Project Name : "),t.qZA()()(),t.TgZ(7,"select",20),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.projectID=n)})("change",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.projectSelectionChange())}),t.TgZ(8,"option",21),t._uU(9,"Select project"),t.qZA(),t.YNc(10,U,2,2,"option",22),t.qZA(),t.YNc(11,J,3,2,"button",23),t.qZA(),t.YNc(12,M,11,4,"div",24),t._UZ(13,"hr",4),t.BQk()}if(2&s){const e=t.oxw();t.xp6(3),t.Q6J("icon",e.faCogs),t.xp6(4),t.Q6J("ngModel",e.projectID),t.xp6(3),t.Q6J("ngForOf",e.projects),t.xp6(1),t.Q6J("ngIf","0"!=e.projectID&&!e.isNeedToShowNewProjectName),t.xp6(1),t.Q6J("ngIf",e.isNeedToShowNewProjectName)}}function E(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"a",28),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.showSpecialOrderForm())}),t.TgZ(1,"h4"),t._uU(2,"Order Special Product"),t.qZA()()}if(2&s){const e=t.oxw();t.Q6J("ngClass",e.needToEnableSpecialOrderLink?"":"link_disabled")}}function F(s,i){1&s&&(t.TgZ(0,"th",14),t._uU(1,"Select"),t.qZA())}function B(s,i){1&s&&(t.TgZ(0,"th"),t._uU(1,"Edit Finish"),t.qZA())}function Q(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"td")(1,"input",41,42),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,o=t.oxw();return t.KtG(o.checkBox(n))}),t.qZA()()}}function G(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"td")(1,"input",43),t.NdJ("click",function(n){t.CHM(e);const o=t.oxw().index,a=t.oxw();return t.KtG(a.editFinish(o,n))}),t.qZA()()}if(2&s){const e=t.oxw().index,r=t.oxw();t.xp6(1),t.s9C("value",e),t.Q6J("formControl",r.editCtrl.controls[e])}}function L(s,i){if(1&s&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.Oqu(e)}}function $(s,i){if(1&s&&(t.TgZ(0,"p",44),t._uU(1),t.YNc(2,L,2,1,"span",45),t.qZA()),2&s){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.productID," "),t.xp6(1),t.Q6J("ngForOf",e.finishCode)}}function Y(s,i){if(1&s&&(t.TgZ(0,"p",44),t._uU(1),t.qZA()),2&s){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.fullSpecificationCode," ")}}function R(s,i){1&s&&(t.TgZ(0,"span"),t._uU(1," / price:0"),t.qZA())}function H(s,i){if(1&s&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&s){const e=t.oxw().index,r=t.oxw(2).$implicit;t.xp6(1),t.AsE(" -> ",r.finishName[e]," | ",r.finishPrice[e],"")}}const K=function(s,i){return{"bg-purple text-white":s,"clr-grey":i}};function V(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"div",37)(1,"a",52),t.NdJ("click",function(){const o=t.CHM(e).$implicit,a=t.oxw().index,p=t.oxw(2).index,d=t.oxw();return t.KtG(d.changeOrderCode(p,a,o.name,o.PRICES.PRICE.Text,o.DESCRIPTIONS.TEXT.Text))}),t._uU(2),t.qZA()()}if(2&s){const e=i.$implicit,r=t.oxw().index,n=t.oxw(2).$implicit;t.xp6(1),t.Q6J("ngClass",t.WLB(2,K,e.name==n.finishCode[r],e.name!=n.finishCode[r])),t.xp6(1),t.hij(" ",e.DESCRIPTIONS.TEXT.Text," ")}}const z=function(s,i){return{"clr-red":s,"text-success":i}};function X(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"div",47)(1,"a",48),t.NdJ("click",function(){const o=t.CHM(e).index,a=t.oxw(2).index,p=t.oxw();return t.KtG(p.finishCollapseToggle(a,o))}),t._UZ(2,"fa-icon",2),t._uU(3),t.YNc(4,R,2,0,"span",0),t.YNc(5,H,2,2,"span",0),t.qZA(),t.TgZ(6,"div",49,50),t.YNc(8,V,3,5,"div",51),t.qZA()()}if(2&s){const e=i.$implicit,r=i.index,n=t.oxw(2).$implicit,o=t.oxw();t.xp6(1),t.Q6J("ngClass",t.WLB(7,z,"??"==n.finishCode[r].trim(),"??"!=n.finishCode[r].trim())),t.xp6(1),t.Q6J("icon",o.faCaretDown),t.xp6(1),t.hij(" ",e.grp.DESCRIPTIONS.TEXT.Text," "),t.xp6(1),t.Q6J("ngIf",null==n.finishPrice[r]),t.xp6(1),t.Q6J("ngIf",null!=n.finishPrice[r]),t.xp6(1),t.Q6J("ngbCollapse",e.collapse),t.xp6(2),t.Q6J("ngForOf",n.finishOptions[r])}}function W(s,i){if(1&s&&(t.ynx(0,37),t.YNc(1,X,9,10,"div",46),t.BQk()),2&s){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngForOf",e.productGroup)}}const tt=function(s){return{"bg-red":s}};function et(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"tr",29)(1,"td")(2,"b"),t._uU(3),t.qZA()(),t.TgZ(4,"td")(5,"input",30),t.NdJ("change",function(){const o=t.CHM(e).index,a=t.oxw();return t.KtG(a.changeTagName(o))}),t.qZA()(),t.YNc(6,Q,3,0,"td",0),t.YNc(7,G,2,2,"td",0),t.TgZ(8,"td",31),t._UZ(9,"img",32),t.qZA(),t.TgZ(10,"td"),t._uU(11),t.ALo(12,"uppercase"),t.qZA(),t.TgZ(13,"td"),t._uU(14),t.ALo(15,"uppercase"),t.qZA(),t.TgZ(16,"td"),t.YNc(17,$,3,2,"p",33),t.YNc(18,Y,2,1,"p",33),t.YNc(19,W,2,1,"ng-container",34),t.qZA(),t.TgZ(20,"td",35)(21,"div",36)(22,"div")(23,"p",37),t._uU(24),t.qZA()()()(),t.TgZ(25,"td",11)(26,"div",38)(27,"button",39),t.NdJ("click",function(){const o=t.CHM(e).index,a=t.oxw();return t.KtG(a.stepDown(o))}),t._uU(28,"-"),t.qZA(),t.TgZ(29,"input",40),t.NdJ("change",function(){const o=t.CHM(e).index,a=t.oxw();return t.KtG(a.changePrice(o))}),t.qZA(),t.TgZ(30,"button",39),t.NdJ("click",function(){const o=t.CHM(e).index,a=t.oxw();return t.KtG(a.stepUp(o))}),t._uU(31,"+"),t.qZA()()(),t.TgZ(32,"td"),t._uU(33),t.ALo(34,"currency"),t.qZA(),t.TgZ(35,"td"),t._uU(36),t.ALo(37,"currency"),t.qZA()()}if(2&s){const e=i.$implicit,r=i.index,n=t.oxw();t.Q6J("ngClass",t.VKq(26,tt,""==e.backgroundColor)),t.xp6(3),t.hij("",r+1,")"),t.xp6(2),t.Q6J("formControl",n.tagNameArray.controls[r]),t.xp6(1),t.Q6J("ngIf",!n.isDealer),t.xp6(1),t.Q6J("ngIf",!n.isDealer),t.xp6(2),t.FAE("src","",n.baseUrl,"assets/",e.companyCode,"/",e.catalogName,"/prod_icons/",e.productImage,"",t.LSH),t.xp6(2),t.Oqu(t.lcZ(12,18,e.companyCode)),t.xp6(3),t.Oqu(t.lcZ(15,20,e.catalogName)),t.xp6(3),t.Q6J("ngIf",!e.isSpecialProduct),t.xp6(1),t.Q6J("ngIf",e.isSpecialProduct),t.xp6(1),t.Q6J("ngIf",e.edit),t.xp6(5),t.Oqu(e.displayName),t.xp6(5),t.Q6J("formControl",n.qtyArray.controls[r]),t.xp6(4),t.Oqu(t.lcZ(34,22,e.unitPrice)),t.xp6(3),t.Oqu(t.lcZ(37,24,e.quantity*e.unitPrice))}}function it(s,i){1&s&&t._UZ(0,"td",56)}function rt(s,i){1&s&&t._UZ(0,"td",57)}function nt(s,i){if(1&s&&(t.TgZ(0,"tr"),t.YNc(1,it,1,0,"td",53),t.YNc(2,rt,1,0,"td",54),t.TgZ(3,"td",55),t._uU(4,"Grand Total"),t.qZA(),t.TgZ(5,"td",55),t._uU(6),t.ALo(7,"currency"),t.qZA()()),2&s){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",!e.isDealer),t.xp6(1),t.Q6J("ngIf",e.isDealer),t.xp6(4),t.hij(" ",t.lcZ(7,3,e.grandTotal)," ")}}function st(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",62),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.removeItem())}),t._UZ(1,"fa-icon",2),t._uU(2," Delete "),t.qZA()}if(2&s){const e=t.oxw(2);t.Q6J("disabled",e.deleteItem),t.xp6(1),t.Q6J("icon",e.faTrash)}}function ot(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",63),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.finishEdit())}),t._UZ(1,"fa-icon",2),t._uU(2," Finish Editing "),t.qZA()}if(2&s){const e=t.oxw(2);t.Q6J("disabled",e.finishEditing),t.xp6(1),t.Q6J("icon",e.faPencil)}}function at(s,i){if(1&s&&(t.TgZ(0,"a",64),t._uU(1," Checkout "),t.qZA()),2&s){const e=t.oxw(2);t.ekj("disabled",0==e.cart.length)}}function ct(s,i){if(1&s&&(t.TgZ(0,"div",58),t.YNc(1,st,3,2,"button",59),t.YNc(2,ot,3,2,"button",60),t.YNc(3,at,2,2,"a",61),t.qZA()),2&s){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",!e.isDealer),t.xp6(1),t.Q6J("ngIf",!e.isDealer),t.xp6(1),t.Q6J("ngIf",e.isDealer)}}function lt(s,i){1&s&&t._UZ(0,"div",65)}function dt(s,i){if(1&s&&(t.TgZ(0,"div",77),t._uU(1),t.qZA()),2&s){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.specialOrderValidationMessage," ")}}function ht(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"div",66)(1,"div",67)(2,"h1",68),t._uU(3,"Add product information"),t.qZA(),t.TgZ(4,"div",69)(5,"span",70),t._uU(6,"Product Code:"),t.qZA(),t.TgZ(7,"input",71),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.specialOrderProductCode=n)}),t.qZA()(),t.TgZ(8,"div",69)(9,"span",70),t._uU(10,"Product Price:"),t.qZA(),t.TgZ(11,"input",71),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.specialOrderUnitPrice=n)}),t.qZA()(),t.TgZ(12,"div",69)(13,"span",70),t._uU(14,"Order Code:"),t.qZA(),t.TgZ(15,"input",71),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.specialOrderCode=n)}),t.qZA()(),t.TgZ(16,"div",69)(17,"span",70),t._uU(18,"Product description:"),t.qZA(),t.TgZ(19,"textarea",72),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.specialOrderDescription=n)}),t.qZA()(),t.YNc(20,dt,2,1,"div",73),t.TgZ(21,"div",74)(22,"button",75),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.saveProductInformationDialog())}),t._uU(23,"Save"),t.qZA(),t.TgZ(24,"button",76),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.cancelProductInformationDialog())}),t._uU(25,"Cancel"),t.qZA()()()()}if(2&s){const e=t.oxw();t.xp6(7),t.Q6J("ngModel",e.specialOrderProductCode),t.xp6(4),t.Q6J("ngModel",e.specialOrderUnitPrice),t.xp6(4),t.Q6J("ngModel",e.specialOrderCode),t.xp6(4),t.Q6J("ngModel",e.specialOrderDescription),t.xp6(1),t.Q6J("ngIf",""!=e.specialOrderValidationMessage)}}class C{constructor(i,e,r,n,o,a){this.store=i,this.cartService=e,this.fb=r,this.busService=n,this.projectService=o,this.businessCentralService=a,this.baseUrl=I.N.baseUrl,this.faCaretDown=m.eW2,this.faTrash=m.$aW,this.faPencil=m.TzT,this.faUsers=m.FVb,this.faAddressBook=m.hVn,this.faCogs=m.Kb6,this.company=null,this.catalogue=null,this.singleProductData={id:null,item:null,group:[],price:null,description:"No Description",finishImages:[],finishOptions:[],finishCode:[],finishPrice:[],finishName:[],qty:1},this.cart=[],this.tagNameArray=this.fb.array([]),this.qtyArray=this.fb.array([]),this.editCtrl=this.fb.array([]),this.finishEditing=!0,this.selectedIndex=[],this.editIndex=0,this.deleteItem=!0,this.grandTotal=null,this.loggedInUser=null,this.userID=0,this.isDealer=!0,this.dealerName="Furniture Dealer",this.projectName="No Project Selected",this.projectID="",this.projects=[],this.newProjectName="",this.isNeedToShowNewProjectName=!1,this.cloneProjectButtonText="Clone this project",this.needToEnableSpecialOrderLink=!1,this.showProductInformationDialog=!1,this.specialOrderValidationMessage="",this.specialOrderProductCode="",this.specialOrderUnitPrice="",this.specialOrderDescription="",this.specialOrderCode="",this.isBusinessCentral=!0,this.manufacturingCompany=""}getAdminCart(){let i=this.cartService._storageService.getItem("user");i=JSON.parse(i),this.cartService.getAdminCartItems(i.id,i.projectID).subscribe({next:e=>{e&&e.data&&(this.cart=e.data,this.loggedInUser.dealers_id>0?(this.userID=this.loggedInUser.id,this.isDealer=!1,this.loggedInUser.BCProjectNumber||(this.isBusinessCentral=!1)):0==this.projects.length&&this.loadProjects(),this.loadCartDetails())}})}getCart(){let i=this.cartService._storageService.getItem("user");i=JSON.parse(i),i.dealers_id>0?this.getUserCart():this.getAdminCart()}getUserCart(){let i=this.cartService._storageService.getItem("user");i=JSON.parse(i),this.cartService.getCartItemsByUserIDProjectIDAndManufacturingCompany(i.id,i.projectID,"").subscribe({next:e=>{e&&e.data&&(this.cart=e.data,this.loggedInUser.dealers_id>0?(this.userID=this.loggedInUser.id,this.isDealer=!1,this.loggedInUser.BCProjectNumber||(this.isBusinessCentral=!1)):0==this.projects.length&&this.loadProjects(),this.loadCartDetails())}})}loadCartDetails(){let i=0;this.cart.length>0&&this.cart.forEach(e=>{e.finishOptions=JSON.parse(e.finishOptions),e.productGroup=JSON.parse(e.productGroup),e.finishCode=JSON.parse(e.finishCode),e.finishName=JSON.parse(e.finishName),e.finishPrice=JSON.parse(e.finishPrice),e.edit=!1,i+=+e.quantity*e.unitPrice,this.tagNameArray.push(new l.NI(e.tagName)),this.qtyArray.push(new l.NI({value:e.quantity,disabled:!0})),this.editCtrl.push(new l.NI(!1))}),this.grandTotal=parseFloat(i.toString()).toFixed(2)}changeTagName(i){this.cart[i].tagName=this.tagNameArray.controls[i].value,this.updateAndReloadCartDetails(i)}checkBox(i){if(null==this.selectedIndex.find(r=>r==i))this.selectedIndex.push(i),this.deleteItem=!1;else{let r=this.selectedIndex.findIndex(n=>n==i);this.selectedIndex.splice(r,1),0==this.selectedIndex.length&&(this.deleteItem=!0)}this.needToEnableSpecialOrderLink=this.selectedIndex&&1===this.selectedIndex.length}editFinish(i,e){if(this.editIndex=i,this.cart[i].isSpecialProduct)return alert("This is a special order product. You cannot edit the finish of such product. Please remove this item from cart and add again to proceed with updating the finish."),void e.preventDefault();let n=this.cart.findIndex(o=>1==o.edit);-1!=n&&(this.cart[n].edit=!1),this.cart[i].edit=!0,this.finishEditing=!1}finishEdit(){let i=0;this.editCtrl.controls.forEach(e=>{e.setValue(!1),this.cart[i]&&(this.cart[i].edit=!1,i++)}),this.updateAndReloadCartDetails(this.editIndex)}removeItem(){let i=this.cart.filter(e=>this.selectedIndex.map(r=>r.id).indexOf(e.id)>-1);i&&i.length>0&&this.cartService.deleteCartItems(i.map(e=>e.id)).subscribe({next:e=>{console.log(`delete status: ${e}`),this.cart=this.cart.filter(r=>this.selectedIndex.map(n=>n.id).indexOf(r.id)<0),this.loadCartDetails()},error:e=>{console.log(`Something went wrong while delete the cart items. Error details: ${JSON.stringify(e)}`)}})}finishCollapseToggle(i,e){this.cart[i].productGroup.forEach((r,n)=>{console.log(n,e),r.collapse=n!=e||!r.collapse,console.log(r)}),console.log(this.cart[i])}changeOrderCode(i,e,r,n,o){null==this.cart[i].finishImages&&(this.cart[i].finishImages=[]),this.cart[i].finishImages[e]=e,this.cart[i].finishCode[e]=r,this.cart[i].fullSpecificationCode=this.cart[i].productID+r,this.cart[i].finishName[e]=o,null!=n&&null==this.cart[i].finishPrice[e]&&(this.cart[i].finishPrice[e]=parseFloat(n),this.cart[i].unitPrice=+this.cart[i].unitPrice+ +this.cart[i].finishPrice[e],this.cart[i].unitPrice=parseFloat(this.cart[i].unitPrice).toFixed(2)),null==this.cart[i].finishCode.find(p=>" ??"==p)&&(this.cart[i].backgroundColor="true"),this.editFinish(i,null)}stepDown(i){1!=this.qtyArray.controls[i].value&&(this.qtyArray.controls[i].setValue(this.qtyArray.controls[i].value-1),this.changePrice(i))}stepUp(i){this.qtyArray.controls[i].setValue(this.qtyArray.controls[i].value+1),this.changePrice(i)}changePrice(i){this.cart[i].quantity=this.qtyArray.controls[i].value,this.updateAndReloadCartDetails(i)}onDrop(i){console.log(i),this.setProduct(i.element.parent.parent.data.id,i.element.parent.data.id,i.element.data.id)}setProduct(i,e,r){console.log(i,e,r),this.singleProductData.group=[],this.singleProductData.finishImages=[],this.singleProductData.finishCode=[],this.singleProductData.finishPrice=[],this.singleProductData.finishName=[],this.singleProductData.finishOptions=[],this.singleProductData.id=r,this.singleProductData.item=this.catalogue.ITEMS.ITEM.find(n=>n.id==this.singleProductData.id),this.singleProductData.item.ITEM_GROUPS.ITEM_GROUP instanceof Array?this.singleProductData.item.ITEM_GROUPS.ITEM_GROUP.forEach((n,o)=>{this.productGroup(n.id,o)}):this.productGroup(this.singleProductData.item.ITEM_GROUPS.ITEM_GROUP.id,0),this.singleProductData.price=parseFloat(this.singleProductData.item.PRICES.PRICE.Text),this.company&&this.getProductSectionTextFile(i,e),this.addToCart()}productGroup(i,e){let r=this.catalogue.GROUPS.GROUP.find(n=>n.id==i);this.singleProductData.group.push({grp:r,collapse:!0}),this.singleProductData.finishCode.push(" ??"),r.OPTIONS.OPTION instanceof Array?this.singleProductData.finishOptions[e]=r.OPTIONS.OPTION:(this.singleProductData.finishOptions[e]=[],this.singleProductData.finishOptions[e].push(r.OPTIONS.OPTION))}getProductSectionTextFile(i,e){console.log(this.company),this.cartService.getSectionTextFile(i,e,this.catalogue.catalogueCode,this.company?.company?.CompanyName).subscribe({next:r=>{this.singleProductData.description=r}})}addToCart(){let e,i=this.singleProductData.finishCode.toString();i=i.replace(/,/g,""),e=i.includes("?")?"":"#cbebc6";const r=JSON.parse(this.cartService._storageService.getItem("user")),n={productID:this.singleProductData.id,productImage:this.singleProductData.id.toLowerCase()+"_3d.png",description:this.singleProductData.description,backgroundColor:e,companyCode:this.company?.company.CompanyName,displayName:this.singleProductData.item.LONG_DESC.TEXT.Text,baseUnitofMeasure:"PCS",unitPrice:parseFloat(this.singleProductData.price.toFixed(2)),quantity:1,genProdPostingGroup:"RETAIL",inventoryPostingGroup:"RESALE",manufacturingCompany:this.catalogue.desc,manufacturingCompanyThreeLettersCode:this.catalogue.code,catalogName:this.catalogue.catalogueCode,catalogThreeLettersCode:this.catalogue.catalogueCode,catalogReleaseDate:`${this.catalogue.year}-${this.catalogue.month}-${this.catalogue.day}`,fullSpecificationCode:this.singleProductData.id+i,tagName:"",finishOptions:JSON.stringify(this.singleProductData.finishOptions),productGroup:JSON.stringify(this.singleProductData.group),finishCode:JSON.stringify(this.singleProductData.finishCode),finishName:JSON.stringify(this.singleProductData.finishName),finishPrice:JSON.stringify(this.singleProductData.finishPrice),edit:!1,users_id:r.id,dealers_id:r.dealers_id,projects_id:r.projectID};this.cartService.addToCart(n).subscribe({next:o=>{console.log(o),this.busService.sendShowCart(),this.getCart()}})}updateAndReloadCartDetails(i){let e={quantity:this.cart[i].quantity,tagName:this.cart[i].tagName,finishCode:JSON.stringify(this.cart[i].finishCode),finishName:JSON.stringify(this.cart[i].finishName),finishPrice:JSON.stringify(this.cart[i].finishPrice),productID:this.cart[i].productID,fullSpecificationCode:this.cart[i].fullSpecificationCode,backgroundColor:this.cart[i].backgroundColor,unitPrice:this.cart[i].unitPrice,displayName:this.cart[i].displayName,isSpecialProduct:this.cart[i].isSpecialProduct};this.cartService.updateCartItem(e,parseInt(this.cart[i].id)).subscribe({next:r=>{this.getCart(),console.log(`cart item update status: ${r}`)},error:r=>{console.log(`Something went wrong while updating the cart. Error details: ${JSON.stringify(r)}`)}})}loadProjects(){this.projectService.getProjectsByDealerID(this.loggedInUser.id).subscribe({next:i=>{this.projects=i,this.projects.filter(e=>e.id==parseInt(this.projectID)).length<=0&&(this.projectID="0")},error:i=>{console.log(`Failed to get projects by dealer id. Error details: ${JSON.stringify(i)}`)}})}sendCartItemsToBusinessCentral(){"user"in localStorage?this.cart&&this.cart.length>0?""!=JSON.parse(this.cartService._storageService.getItem("user")).BCProjectNumber?this.cart.filter(i=>i.fullSpecificationCode.indexOf("?")>-1).length<=0?this.checkIfItemExistsInBusinessCentral():alert("You cannot push items to business central until all products in cart have their finishes selected."):alert("Project not created in Business Central ! Please try again after creating project in Business Central."):alert("No items in cart to push"):alert("Oops ! It seems that you have not logged in. Please login with same user as in business central to push items in business central.")}createBiSemAItem(i){let e=i-1,r={displayName:this.cart[e].displayName,baseUnitofMeasure:this.cart[e].baseUnitofMeasure,unitPrice:this.cart[e].unitPrice,userName:this.cart[e].users_id.toString(),genProdPostingGroup:this.cart[e].genProdPostingGroup,inventoryPostingGroup:this.cart[e].inventoryPostingGroup,manufacturingCompany:this.cart[e].manufacturingCompany,manufacturingCompanyThreeLettersCode:this.cart[e].manufacturingCompanyThreeLettersCode,catalogName:this.cart[e].catalogName,catalogThreeLettersCode:this.cart[e].catalogThreeLettersCode,catalogReleaseDate:this.cart[e].catalogReleaseDate,tagName:this.cart[e].tagName,productID:this.cart[e].productID};this.getBase64FromImageURL(`${this.baseUrl}assets/${this.cart[e].companyCode}/${this.cart[e].catalogName}/prod_icons/${this.cart[e].productImage}`,n=>{""!=n&&(r.picture=n.split("base64,")[1]),this.businessCentralService.postDetailsInDynamics(r,"BiSemAItem").subscribe({next:o=>{o?this.cart[e].businessCentralItemNumber=o.number:console.log("BiSemA Item not created"),this.checkIfItemExistsInBusinessCentral(++i)},error:o=>{console.log(`error occured while calling dynamics BiSemA Item call : ${JSON.stringify(o)}`),this.checkIfItemExistsInBusinessCentral(++i)}})})}checkInBusinessCentral(i){this.businessCentralService.getDetailsFromDynamics("BiSemAItem",`?$filter=productID eq '${this.cart[i-1].productID}'`).subscribe(r=>{r&&r.value&&r.value.length>0?(this.cart[i-1].businessCentralItemNumber=r.value[0].number,this.checkIfItemExistsInBusinessCentral(++i)):this.createBiSemAItem(i)},r=>{console.log(`error occured while calling dynamics BiSemA Item exists check call : ${JSON.stringify(r)}`),this.checkIfItemExistsInBusinessCentral(++i)})}checkIfItemExistsInBusinessCentral(i=1){if(this.cart&&i<=this.cart.length){let e=this.cart[i-1];if(e.businessCentralItemNumber&&""!=e.businessCentralItemNumber)this.checkIfItemExistsInBusinessCentral(++i);else{let r=this.cart.filter(n=>n.productID==e.productID)[0];r&&r.businessCentralItemNumber&&""!=r.businessCentralItemNumber?(this.cart[i-1].businessCentralItemNumber=r.businessCentralItemNumber,this.checkIfItemExistsInBusinessCentral(++i)):this.checkInBusinessCentral(i)}}else this.createBisemaSalesLine(JSON.parse(this.cartService._storageService.getItem("user")).BCProjectNumber)}createBisemaSalesLine(i,e=1){if(this.cart&&e<=this.cart.length){let r=e-1,n=1e4*e,o=[],a=this.cart[r].productGroup;if(a&&a.length>0)for(let d=0;d<a.length;d++){let h={},gt=this.cart[r].finishCode[d],T=a[d].OPTIONS.OPTION.filter(mt=>mt.name==gt);h.FF=a[d].DESCRIPTIONS.TEXT.Text,h.FD=T[0].name,h.FC=T[0].id,o.push(h)}let p={documentType:"Order",documentNumber:i,lineNumber:n,type:"Item",number:this.cart[r].businessCentralItemNumber,description:this.cart[r].displayName,unitofMeasure:this.cart[r].baseUnitofMeasure,quantity:parseInt(this.cart[r].quantity),unitCostLcy:this.cart[r].unitPrice,directUnitCost:this.cart[r].unitPrice,lineAmount:this.cart[r].unitPrice*parseInt(this.cart[r].quantity),userName:this.cart[r].users_id.toString(),manufacturingCompany:this.cart[r].manufacturingCompany,manufacturingCompanyThreeLettersCode:this.cart[r].manufacturingCompanyThreeLettersCode,catalogName:this.cart[r].catalogName,catalogThreeLettersCode:this.cart[r].catalogThreeLettersCode,catalogReleaseDate:this.cart[r].catalogReleaseDate,fullSpecificationCode:this.cart[r].fullSpecificationCode,productID:this.cart[r].productID,tagName:this.cart[r].tagName,finishedDetails:JSON.stringify(o)};this.businessCentralService.postDetailsInDynamics(p,"BiSemASalesLine").subscribe({next:d=>{d?e===this.cart.length?this.projectService.updateProject({isClosed:1,orderConfirmationDate:new Date},JSON.parse(this.cartService._storageService.getItem("user")).projectID).subscribe({next:h=>{alert("Details pushed to Dynamics Business Central !! This project has been closed now. Please refresh your project selection."),this.getCart(),this.projectID="0",this.loadProjects(),this.isNeedToShowNewProjectName=!1,this.cloneProjectButtonText="Clone this project",console.log(`project update status: ${h}`)},error:h=>{console.log(`Something went wrong while updating project details. Error details: ${JSON.stringify(h)}`)}}):this.createBisemaSalesLine(i,++e):console.log(`error occured while calling dynamics BiSemA Sales Line call for ${this.cart[r].businessCentralItemNumber}`)},error:d=>{console.log(`error occured while calling dynamics BiSemA Sales Line call : ${JSON.stringify(d)}`)}})}}getBase64FromImageURL(i,e){const r=new XMLHttpRequest;r.onload=()=>{if(200===r.status){const n=new FileReader;n.onloadend=()=>{e(n.result)},n.readAsDataURL(r.response)}else console.log(`image not found at ${i}`),e("")},r.open("GET",i),r.responseType="blob",r.send()}projectSelectionChange(){const i=parseInt(this.projectID,10);this.loggedInUser.projectID!=i&&(this.loggedInUser.projectID=i,this.loggedInUser.projectName=this.projects.filter(e=>e.id===i)[0].projectName,this.cartService._storageService.setItem("user",JSON.stringify(this.loggedInUser)),this.setDealerAndProjectName(),this.getCart())}setDealerAndProjectName(){if("user"in localStorage){this.loggedInUser=JSON.parse(this.cartService._storageService.getItem("user"));let i=this.loggedInUser.DealerName;i&&""!=i&&(this.dealerName=i);let e=this.loggedInUser.projectID;e&&e>0&&(this.projectID=e.toString());let r=this.loggedInUser.projectName;r&&""!=r&&(this.projectName=r)}}cloneProject(){this.isNeedToShowNewProjectName?""!=this.newProjectName&&this.projectService.checkIfExistsWithName(this.loggedInUser.id,this.newProjectName).subscribe({next:i=>{0==i.data?this.createBiSemASalesHeader():alert(i.message)},error:i=>{console.log(`Error occured while checking if project exists same name or not. Error details: ${JSON.stringify(i)}`)}}):(this.newProjectName=`${this.projectName} - cloned`,this.isNeedToShowNewProjectName=!0,this.cloneProjectButtonText="Create project")}createBiSemASalesHeader(){let i={projectName:this.newProjectName,cloneFrom:this.loggedInUser.BCProjectNumber,isBiSemARecord:!0,documentType:"Order",selltocustomerNumber:"10000",orderDate:`${(new Date).getFullYear()}-${("0"+((new Date).getMonth()+1)).slice(-2)}-${("0"+(new Date).getDate()).slice(-2)}`};this.businessCentralService.postDetailsInDynamics(i,"BiSemASalesHeader",this.loggedInUser).subscribe({next:e=>{e?this.projectService.cloneProject({projectName:this.newProjectName,cloneFromProjectNumber:this.loggedInUser.BCProjectNumber,projectNumber:e.number}).subscribe(n=>{n.data>0?(this.projectID="0",this.loadProjects(),this.isNeedToShowNewProjectName=!1,this.cloneProjectButtonText="Clone this project",alert("Project has been cloned successfully. It will get populated in selection list."),setTimeout(()=>{this.setDealerAndProjectName()},200)):alert(n.message)},n=>{console.log(`Error occured while creating project. Error details: ${JSON.stringify(n)}`)}):console.log("BiSemA Sales Header not created")},error:e=>{console.log(`error occured while calling dynamics BiSemA Sales Header call : ${JSON.stringify(e)}`)}})}cancelProjectCreate(){this.isNeedToShowNewProjectName=!1,this.cloneProjectButtonText="Clone this project"}showSpecialOrderForm(){let i=this.cart.filter(e=>e.id===this.selectedIndex[0].id);i&&i.length>0?(this.specialOrderProductCode=i[0].productID,this.specialOrderUnitPrice=i[0].unitPrice,this.specialOrderCode=i[0].fullSpecificationCode.replace(i[0].productID,""),this.specialOrderDescription=i[0].displayName,this.specialOrderValidationMessage=""):(this.specialOrderProductCode="",this.specialOrderUnitPrice="",this.specialOrderDescription="",this.specialOrderValidationMessage=""),this.showProductInformationDialog=!0}cancelProductInformationDialog(){this.showProductInformationDialog=!1,this.needToEnableSpecialOrderLink=!1,this.selectedIndex=[],this.checkboxes.forEach(i=>{i.nativeElement.checked=!1}),this.deleteItem=!0}saveProductInformationDialog(){if(this.selectedIndex&&this.selectedIndex.length>0)if(""!=this.specialOrderProductCode)if(""!=this.specialOrderUnitPrice)if(""!=this.specialOrderDescription){let i=this.cart.findIndex(e=>e.id===this.selectedIndex[0].id);i>-1?(this.cart[i].isSpecialProduct=!0,this.cart[i].productID=this.specialOrderProductCode,this.cart[i].fullSpecificationCode=this.specialOrderProductCode+this.specialOrderCode,this.cart[i].unitPrice=parseFloat(this.specialOrderUnitPrice).toFixed(2),this.cart[i].displayName=this.specialOrderDescription,this.cart[i].backgroundColor=this.cart[i].fullSpecificationCode.indexOf("?")<0?"true":"",this.updateAndReloadCartDetails(i),this.needToEnableSpecialOrderLink=!1,this.showProductInformationDialog=!1,this.selectedIndex=[],this.checkboxes.forEach(e=>{e.nativeElement.checked=!1}),this.deleteItem=!0):alert("It seems that the item you selected for special order not found. Please try again.")}else this.specialOrderValidationMessage="Please enter product description";else this.specialOrderValidationMessage="Please enter product price";else this.specialOrderValidationMessage="Please enter product code"}getCompany(){this.store.select(P.p).subscribe({next:i=>{this.company=i}})}getCatalogue(){this.store.select(b.P).subscribe({next:i=>{this.catalogue=i}})}ngOnInit(){this.getCompany(),this.getCatalogue(),this.setDealerAndProjectName(),this.getCart()}}C.\u0275fac=function(i){return new(i||C)(t.Y36(S.yh),t.Y36(u),t.Y36(l.qu),t.Y36(y.Z),t.Y36(Z.Y),t.Y36(v.y))},C.\u0275cmp=t.Xpm({type:C,selectors:[["app-cart"]],viewQuery:function(i,e){if(1&i&&t.Gf(A,5),2&i){let r;t.iGM(r=t.CRH())&&(e.checkboxes=r)}},decls:48,vars:11,consts:[[4,"ngIf"],[1,"text-center","mt-2","ml-0","mr-0"],[3,"icon"],[1,"text-muted"],[1,"border-dark"],[1,"d-flex","justify-content-between","align-items-center"],[1,"mt-2","pt-2","text-center"],[1,"me-2"],["style","cursor: pointer;","class","clr-purple",3,"ngClass","click",4,"ngIf"],[1,"table","table-bordered",3,"treeDrop"],[1,"thead-light"],[1,"text-center"],["scope","col",4,"ngIf"],["scope","col",1,"bordNone"],["scope","col"],["class","text-center data",3,"ngClass",4,"ngFor","ngForOf"],["class","col-12 text-end",4,"ngIf"],["class","dialog_overlay",4,"ngIf"],["class","card dialog",4,"ngIf"],[1,"d-flex","mt-2","justify-content-center","align-items-center"],["id","projects",1,"form-control","w-25",3,"ngModel","ngModelChange","change"],["value","0"],[3,"value",4,"ngFor","ngForOf"],["class","btn btn-dark btn-sm btn2 p-2",3,"click",4,"ngIf"],["class","d-flex mt-2 justify-content-center align-items-center",4,"ngIf"],[3,"value"],[1,"btn","btn-dark","btn-sm","btn2","p-2",3,"click"],["type","text","name","newProjectName","id","newProjectName","placeholder","Enter new project name",1,"form-control","w-25",3,"ngModel","ngModelChange"],[1,"clr-purple",2,"cursor","pointer",3,"ngClass","click"],[1,"text-center","data",3,"ngClass"],["type","text","placeholder","Type tagname ...",1,"tag-name",3,"formControl","change"],[1,"img-hover-zoom"],["width","100","alt","Buy",3,"src"],["class","code text-start",4,"ngIf"],["class","text-start",4,"ngIf"],[1,"bordNone"],[1,"cart-info"],[1,"text-start"],[1,"input-group","bg-main","mb-3","qtyInput2"],["type","button",1,"btn","bg-light-purple","border",3,"click"],["min","1","value","1",1,"form-control","form-control-sm",3,"formControl","change"],["type","checkbox",3,"click"],["cartCheckboxes",""],["type","radio","name","finish","id","",3,"formControl","value","click"],[1,"code","text-start"],[4,"ngFor","ngForOf"],["class","menu mb-2 text-start",4,"ngFor","ngForOf"],[1,"menu","mb-2","text-start"],["href","javascript:;",1,"text-decoration-none","text-start","fw-bold",3,"ngClass","click"],[3,"ngbCollapse"],["finishCollapse","ngbCollapse"],["class","text-start",4,"ngFor","ngForOf"],["href","javascript:;",1,"side-child-item","p-1","text-decoration-none","text-start",3,"ngClass","click"],["colspan","10",4,"ngIf"],["colspan","8",4,"ngIf"],[1,"fw-bold","text-center"],["colspan","10"],["colspan","8"],[1,"col-12","text-end"],["class","float-right btn btn3 me-1",3,"disabled","click",4,"ngIf"],["class","float-right btn btn2 mx-1",3,"disabled","click",4,"ngIf"],["routerLink","/admin/checkout","target","_blank","class","float-right btn btn2 me-1","role","button",3,"disabled",4,"ngIf"],[1,"float-right","btn","btn3","me-1",3,"disabled","click"],[1,"float-right","btn","btn2","mx-1",3,"disabled","click"],["routerLink","/admin/checkout","target","_blank","role","button",1,"float-right","btn","btn2","me-1"],[1,"dialog_overlay"],[1,"card","dialog"],[1,"card-body","bg-purple"],[1,"text-center","text-white","mb-3"],[1,"input-group","mb-3"],[1,"text-white","mt-2","mr-3",2,"width","20%"],["type","text",1,"form-control",3,"ngModel","ngModelChange"],[1,"form-control",3,"ngModel","ngModelChange"],["class","input-group mb-3 text-white text-center","style","display: block",4,"ngIf"],[1,"mb-3","text-center"],[1,"btn","btn-light","btn2","me-3",3,"click"],[1,"btn","btn-light","btn2",3,"click"],[1,"input-group","mb-3","text-white","text-center",2,"display","block"]],template:function(i,e){1&i&&(t.TgZ(0,"div"),t.YNc(1,q,14,5,"ng-container",0),t.TgZ(2,"div")(3,"h4",1),t._UZ(4,"fa-icon",2),t.TgZ(5,"small",3)(6,"b"),t._uU(7," Dealer Name : "),t.qZA()(),t._uU(8),t.qZA()()(),t._UZ(9,"hr",4),t.TgZ(10,"div",5),t._UZ(11,"div"),t.TgZ(12,"h4",6),t._uU(13," List of products in cart "),t.qZA(),t.TgZ(14,"div",7),t.YNc(15,E,3,1,"a",8),t.qZA()(),t._UZ(16,"hr",4),t.TgZ(17,"table",9),t.NdJ("treeDrop",function(n){return e.onDrop(n)}),t.TgZ(18,"thead",10)(19,"tr",11)(20,"th"),t._uU(21,"Item Number"),t.qZA(),t.TgZ(22,"th"),t._uU(23,"Tagname"),t.qZA(),t.YNc(24,F,2,0,"th",12),t.YNc(25,B,2,0,"th",0),t.TgZ(26,"th"),t._uU(27,"Product Image"),t.qZA(),t.TgZ(28,"th"),t._uU(29,"Mfg"),t.qZA(),t.TgZ(30,"th"),t._uU(31,"Cat"),t.qZA(),t.TgZ(32,"th"),t._uU(33,"Order Code"),t.qZA(),t.TgZ(34,"th",13),t._uU(35,"Product Descriptions"),t.qZA(),t.TgZ(36,"th",14),t._uU(37,"Quantity"),t.qZA(),t.TgZ(38,"th",14),t._uU(39,"Unit Price"),t.qZA(),t.TgZ(40,"th",14),t._uU(41,"Total Price"),t.qZA()()(),t.TgZ(42,"tbody"),t.YNc(43,et,38,28,"tr",15),t.YNc(44,nt,8,5,"tr",0),t.qZA()(),t.YNc(45,ct,4,3,"div",16),t.YNc(46,lt,1,0,"div",17),t.YNc(47,ht,26,5,"div",18)),2&i&&(t.xp6(1),t.Q6J("ngIf",e.isDealer),t.xp6(3),t.Q6J("icon",e.faUsers),t.xp6(4),t.hij("",e.dealerName," "),t.xp6(7),t.Q6J("ngIf",!e.isDealer),t.xp6(9),t.Q6J("ngIf",!e.isDealer),t.xp6(1),t.Q6J("ngIf",!e.isDealer),t.xp6(18),t.Q6J("ngForOf",e.cart),t.xp6(1),t.Q6J("ngIf",e.cart.length>0),t.xp6(1),t.Q6J("ngIf",e.cart.length>0),t.xp6(1),t.Q6J("ngIf",e.showProductInformationDialog),t.xp6(1),t.Q6J("ngIf",e.showProductInformationDialog))},dependencies:[g.mk,g.sg,g.O5,l.YN,l.Kr,l.Fj,l.EJ,l._,l.JJ,l.On,l.oH,O._D,j.BN,w.Vh,x.rH,g.gd,g.H9],styles:[".qtyInput2[_ngcontent-%COMP%]{width:100px}.disabled[_ngcontent-%COMP%]{cursor:not-allowed}.link_disabled[_ngcontent-%COMP%], .link_disabled[_ngcontent-%COMP%]:hover{opacity:.5;cursor:not-allowed!important;color:#000!important}.dialog[_ngcontent-%COMP%]{top:50%;left:50%;width:50em;margin-top:-9em;margin-left:-25em;position:fixed;border:none!important;z-index:9999}.dialog_overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:#000;opacity:.4;z-index:999}"]});const ut=[{path:"",component:C}];class f{}f.\u0275fac=function(i){return new(i||f)},f.\u0275mod=t.oAB({type:f}),f.\u0275inj=t.cJS({imports:[x.Bz.forChild(ut),x.Bz]});var pt=c(710);class _{}_.\u0275fac=function(i){return new(i||_)},_.\u0275mod=t.oAB({type:_}),_.\u0275inj=t.cJS({providers:[u],imports:[g.ez,pt.m,f]})}}]);